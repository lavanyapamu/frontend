<!-- Artist Orders Dashboard -->
<div class="orders-container">
  <div class="header-section">
    <h2 class="page-title">Orders</h2>

  </div>

  <!-- Filters and Search Section -->
  <div class="filters-section">
    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label for="statusFilter">Filter by Status:</label>
          <select id="statusFilter" class="form-control" [(ngModel)]="selectedStatusFilter" (change)="filterOrders()">
            <option value="">All Orders</option>
            <option *ngFor="let status of statuses" [value]="status">
              {{ status | titlecase }}
            </option>
          </select>

        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <label for="searchInput">Search Orders:</label>
          <input type="text" id="searchInput" class="form-control" placeholder="Search by Order ID or Customer"
            [(ngModel)]="searchTerm" (input)="filterOrders()">
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
    <p class="mt-2">Loading orders...</p>
  </div>

  <!-- Orders Table -->
  <div class="table-section" *ngIf="!isLoading">
    <div class="table-responsive">
      <table class="table table-hover orders-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Artwork</th>
            <th>Customer</th>
            <th>Quantity</th>
            <th>Total Price</th>
            <th>Order Date</th>
            <th>Status</th> <!-- Status comes here -->
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let order of paginatedOrders" class="order-row">
            <!-- Order ID -->
            <td class="order-id">
              <span class="order-badge">{{ order.order_id.substring(0, 8) }}...</span>
            </td>

            <!-- Artwork -->
            <td class="artwork-info">
              <div *ngFor="let item of order.items" class="artwork-item">
                <strong>{{ item.artwork?.title || 'Artwork ID: ' + item.artwork_id }}</strong>
              </div>
            </td>

            <!-- Customer -->
            <td class="customer-name">
              <div class="customer-info">
                <i class="fas fa-user customer-icon"></i>
                {{ order.user_name | titlecase }}
              </div>
            </td>

            <!-- Quantity -->
            <td class="quantity">
              <span class="quantity-badge">{{ getTotalQuantity(order) }}</span>
            </td>

            <!-- Price -->
            <td class="price">
              <span class="price-amount">
                {{ order?.total_price | currency:'INR':'symbol':'1.2-2':'en-IN' }}
              </span>
            </td>

            <!-- Order Date -->
            <td class="order-date">
              {{ formatDate(order.created_at) }}
            </td>

            <!-- ðŸ”¹ Status (new column, after date) -->
            <td class="status">
              <div *ngFor="let item of order.items" class="status-item">
                <select class="form-control status-dropdown ms-2" [class]="'status-' + item.status"
                  [value]="item.status" (change)="updateOrderItemStatus(order.order_id, item.order_item_id, $event)">

                  <option *ngFor="let status of statuses" [value]="status">
                    {{ status | titlecase }}
                  </option>
                </select>

              </div>
            </td>

            <!-- Actions -->
            <td class="actions">
              <button class="btn btn-sm btn-primary view-btn" (click)="viewOrderDetails(order)">
                <i class="fas fa-eye"></i> View
              </button>
            </td>
          </tr>
        </tbody>

      </table>
    </div>

    <!-- No Orders Message -->
    <div *ngIf="filteredOrders.length === 0 && !isLoading" class="no-orders">
      <div class="no-orders-content">
        <i class="fas fa-inbox no-orders-icon"></i>
        <h4>No Orders Found</h4>
        <p>{{ searchTerm || selectedStatusFilter ? 'No orders match your current filters.' : 'No orders available at the
          moment.' }}</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-section" *ngIf="filteredOrders.length > 0 && !isLoading">
    <nav aria-label="Orders pagination">
      <ul class="pagination justify-content-end">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
            <i class="fas fa-chevron-left"></i> Previous
          </button>
        </li>

        <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
          <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>

    <div class="pagination-info">
      Showing {{ getStartIndex() + 1 }} to {{ getEndIndex() }} of {{ filteredOrders.length }} orders
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" role="dialog" aria-labelledby="orderDetailsModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderDetailsModalLabel">Order Details</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="selectedOrder">
        <div class="order-details">
          <div class="row">
            <div class="col-md-6">
              <h6>Order Information</h6>
              <p><strong>Order ID:</strong> {{ selectedOrder.order_id }}</p>
              <p><strong>Customer:</strong> {{ (selectedOrder.user_name) }}</p>
              <p><strong>Total Price:</strong> â‚¹{{ selectedOrder.total_price.toFixed(2) }}</p>
              <p><strong>Status:</strong>
                <span class="badge" [class]="'badge-' + selectedOrder.status">
                  {{ getStatusLabel(selectedOrder.status) }}
                </span>
              </p>
            </div>
            <div class="col-md-6">
              <h6>Order Timeline</h6>
              <p><strong>Order Date:</strong> {{ formatDate(selectedOrder.created_at) }}</p>
              <p *ngIf="selectedOrder">
                <strong>Last Updated:</strong> {{ formatDate(selectedOrder.updated_at) }}
              </p>

            </div>
          </div>

          <div class="order-items mt-4">
            <h6>Order Items</h6>
            <div class="table-responsive">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Artwork</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of selectedOrder.items">
                    <td>{{ item.artwork?.title || 'Artwork ID: ' + item.artwork_id }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.price | currency:'INR':'symbol':'1.2-2' }}</td>
                    <td>{{ (item.quantity * item.price) | currency:'INR':'symbol':'1.2-2' }}</td>

                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>